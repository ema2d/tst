<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مسجدنا</title>
<style>
body { font-family: Tahoma, Arial, sans-serif; margin:0; padding:0; background:#f9fafb; }
header { background:#1e40af; color:white; padding:15px; text-align:center; font-size:20px; font-weight:bold; }
main { padding:20px; text-align:center; }
button { background:#1e40af; color:#fff; border:none; padding:12px 20px; border-radius:12px; font-size:16px; cursor:pointer; margin:10px 0; }
.grid { display:grid; grid-template-columns:repeat(2,1fr); gap:15px; }
.card { background:#e0f2fe; color:#1e40af; border-radius:15px; padding:25px 10px; font-size:16px; font-weight:bold; box-shadow:0 4px 6px rgba(0,0,0,0.1); cursor:pointer; }
.popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:1000; }
.popup-content { background:#fff; border-radius:20px; padding:20px; width:90%; max-width:420px; text-align:right; box-shadow:0 6px 12px rgba(0,0,0,0.2); }
label { font-weight:bold; display:block; margin-top:10px; margin-bottom:5px; }
select,input[type="text"],textarea,input[type="file"],input[type="number"] { width:100%; margin-bottom:10px; padding:8px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
textarea { height:80px; resize:none; }
.actions { display:flex; justify-content:space-between; margin-top:10px; }
.cancel { background:#d1d5db; }
.send { background:#1e40af; color:#fff; }
.report-card { background:#fff; padding:15px; margin:10px; border-radius:12px; box-shadow:0 2px 4px rgba(0,0,0,0.1); text-align:right; }
.nav { display:flex; justify-content:space-around; background:#e5e7eb; padding:10px; position:fixed; bottom:0; left:0; width:100%; }
.nav button { background:none; color:#1e40af; font-weight:bold; font-size:16px; }
img.report-img { max-width:100%; border-radius:8px; margin-top:5px; }
</style>
</head>
<body>

<header>مسجدنا</header>

<!-- الصفحة الرئيسية -->
<main id="homePage">
  <button onclick="showServices()">➕ بلاغ جديد</button>
  <button onclick="showProviderPage()">👷 صفحة مزود الخدمة</button>
  <button onclick="showReportsPage()">📊 تقارير مزودي الخدمة</button>
</main>

<!-- نموذج اختيار الخدمة للمصلي -->
<div class="popup" id="servicePopup">
  <div class="popup-content">
    <h2>اختر نوع الخدمة</h2>
    <div class="grid">
      <div class="card" onclick="openReportPopup('الصيانة',['كهرباء','سباكة','تكييف','إنارة'])">🛠️ الصيانة</div>
      <div class="card" onclick="openReportPopup('النظافة',['تنظيف المسجد','دورات المياه','أدوات النظافة'])">🧹 النظافة</div>
      <div class="card" onclick="openReportPopup('التجهيزات',['مياه','تمر','مصاحف','سجاد','مناديل','معطرات','منظفات'])">📦 التجهيزات</div>
      <div class="card" onclick="openReportPopup('أخرى',[])">✍️ أخرى</div>
    </div>
    <div style="margin-top:15px; text-align:center;">
      <button class="cancel" onclick="closeServices()">إغلاق</button>
    </div>
  </div>
</div>

<!-- نموذج البلاغ -->
<div class="popup" id="reportPopup">
  <div class="popup-content">
    <h2 id="serviceTitle"></h2>

    <div id="subServiceDiv" style="display:none;">
      <label>🔧 نوع الخدمة:</label>
      <select id="subService"></select>
    </div>

    <label>📍 موقع المسجد:</label>
    <input type="text" id="mosqueLocation" placeholder="مثال: مسجد خالد بن الوليد - المدينة">

    <label>📝 تفاصيل البلاغ:</label>
    <textarea id="reportDetails" placeholder="اكتب تفاصيل البلاغ..."></textarea>

    <label>👤 معلومات مسؤول المسجد (اختياري):</label>
    <input type="text" id="contactInfo" placeholder="اسم / رقم جوال">

    <label>📷 إرفاق صورة / فيديو (اختياري):</label>
    <input type="file" id="reportFile" multiple>

    <div class="actions">
      <button class="cancel" onclick="closePopup()">إلغاء</button>
      <button class="send" onclick="sendReport()">إرسال البلاغ</button>
    </div>
  </div>
</div>

<!-- صفحة مزود الخدمة -->
<main id="providerPage" style="display:none;">
  <button onclick="showHome()">🏠 الرئيسية</button>
  <h2>👷 البلاغات الواردة</h2>
  <div id="providerReports"></div>
</main>

<!-- صفحة تقارير مزودي الخدمة -->
<main id="providerReportsPage" style="display:none;">
  <button onclick="showHome()">🏠 الرئيسية</button>
  <h2>📊 تقارير مزودي الخدمة</h2>
  <div id="providerReportsList"></div>
</main>

<script>
let currentService="", subServices=[], reports=[], providerReports=[];

function showServices(){ document.getElementById("servicePopup").style.display="flex"; }
function closeServices(){ document.getElementById("servicePopup").style.display="none"; }

function openReportPopup(service, subs){
  currentService=service;
  subServices=subs;
  document.getElementById("serviceTitle").innerText="🕌 "+service;
  let subDiv=document.getElementById("subServiceDiv");
  let subSelect=document.getElementById("subService");
  if(subs.length>0){ subSelect.innerHTML=""; subs.forEach(s=>{let opt=document.createElement("option"); opt.value=s; opt.innerText=s; subSelect.appendChild(opt); }); subDiv.style.display="block"; }
  else subDiv.style.display="none";
  closeServices();
  document.getElementById("reportPopup").style.display="flex";
}

function closePopup(){ document.getElementById("reportPopup").style.display="none"; }

function sendReport(){
  const location=document.getElementById("mosqueLocation").value;
  const details=document.getElementById("reportDetails").value;
  const contact=document.getElementById("contactInfo").value;
  const files=document.getElementById("reportFile").files;
  const subService=subServices.length>0?document.getElementById("subService").value:"غير محدد";
  if(!location||!details){ alert("⚠️ الرجاء إدخال موقع المسجد وتفاصيل البلاغ"); return; }

  let newReport={service:currentService, sub:subService, location, details, contact, status:"قيد المراجعة", amount:"", note:"", images:[]};
  for(let i=0;i<files.length;i++){
    newReport.images.push(URL.createObjectURL(files[i]));
  }
  reports.push(newReport);
  providerReports.push(newReport);
  alert("✅ تم إرسال البلاغ");
  closePopup();
  showHome();
}

// الصفحة الرئيسية
function showHome(){
  document.getElementById("homePage").style.display="block";
  document.getElementById("providerPage").style.display="none";
  document.getElementById("providerReportsPage").style.display="none";
}

// صفحة مزود الخدمة
function showProviderPage(){
  document.getElementById("homePage").style.display="none";
  document.getElementById("providerPage").style.display="block";
  document.getElementById("providerReportsPage").style.display="none";

  let list=document.getElementById("providerReports");
  list.innerHTML="";
  providerReports.forEach((r,i)=>{
    let card=document.createElement("div");
    card.className="report-card";
    let imagesHTML=r.images.map(img=>`<img class="report-img" src="${img}">`).join("");
    card.innerHTML=`
      <b>الخدمة:</b> ${r.service} (${r.sub})<br>
      <b>الموقع:</b> ${r.location}<br>
      <b>التفاصيل:</b> ${r.details}<br>
      <b>المسؤول:</b> ${r.contact||"غير مضاف"}<br>
      <b>الحالة:</b> ${r.status}<br>
      ${imagesHTML}
      <label>💰 المبلغ المطلوب:</label>
      <input type="number" id="amount${i}" value="${r.amount}" placeholder="ادخل المبلغ">
      <label>📝 ملاحظات / تقرير:</label>
      <textarea id="note${i}" placeholder="اكتب الملاحظات">${r.note}</textarea>
      <button onclick="updateReport(${i})">✅ تأكيد المراجعة</button>
    `;
    list.appendChild(card);
  });
}

// تحديث البلاغ من قبل مزود الخدمة
function updateReport(index){
  let amount=document.getElementById("amount"+index).value;
  let note=document.getElementById("note"+index).value;
  providerReports[index].amount=amount;
  providerReports[index].note=note;
  providerReports[index].status="تم المراجعة";
  alert("✅ تم تحديث البلاغ");
  showProviderPage();
}

// صفحة تقارير مزودي الخدمة
function showReportsPage(){
  document.getElementById("homePage").style.display="none";
  document.getElementById("providerPage").style.display="none";
  document.getElementById("providerReportsPage").style.display="block";

  let list=document.getElementById("providerReportsList");
  list.innerHTML="";
  providerReports.forEach((r)=>{
    if(r.status==="تم المراجعة"){
      let card=document.createElement("div");
      card.className="report-card";
      let imagesHTML=r.images.map(img=>`<img class="report-img" src="${img}">`).join("");
      card.innerHTML=`
        <b>الخدمة:</b> ${r.service} (${r.sub})<br>
        <b>الموقع:</b> ${r.location}<br>
        <b>التفاصيل:</b> ${r.details}<br>
        <b>المسؤول:</b> ${r.contact||"غير مضاف"}<br>
        <b>المبلغ المطلوب:</b> ${r.amount}<br>
        <b>ملاحظات مزود الخدمة:</b> ${r.note}<br>
        ${imagesHTML}
      `;
      list.appendChild(card);
    }
  });
}

// افتح الصفحة الرئيسية أولاً
showHome();
</script>

</body>
</html>
